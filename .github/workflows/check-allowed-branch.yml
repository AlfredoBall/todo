name: Check Source Branch for Merge to Main

on:
  pull_request_target:
    types:
      - opened
      - synchronize
      - reopened
    branches:
      - 'main'

jobs:
  check-allowed-branch:
    name: Validate Merge Strategy
    runs-on: ubuntu-latest
    env:
      ALLOWED_BRANCH: 'development'
    steps:
      - name: Verify Source Branch
        shell: bash
        run: |
          echo "Target Branch (Base): ${{ github.base_ref }}"
          echo "Source Branch (Head): ${{ github.head_ref }}"

          if [[ "${{ github.head_ref }}" != "${{ env.ALLOWED_BRANCH }}" ]]; then
            # This creates a red error annotation in the GitHub PR File View
            echo "::error title=Invalid Branch Merge::Only the '${{ env.ALLOWED_BRANCH }}' branch is allowed to merge into 'main'. You attempted to merge from '${{ github.head_ref }}'."
            exit 1
          else
            echo "Validation successful: '${{ github.head_ref }}' is authorized to merge into 'main'."
          fi

      - name: Success
        # This step only runs if the check above didn't exit 1
        run: echo "Merge strategy check passed. Proceeding with CI/CD checks."